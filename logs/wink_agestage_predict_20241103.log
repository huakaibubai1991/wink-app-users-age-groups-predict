20241103
/data1/www/zxf3/agestage_predict/wink/bin
/data1/www/zxf3/agestage_predict/wink
-----------------------start predict process---------------------------
[          7216195          22365389          26705322 ...
 19995363252976784 19995993232492112 19997253251048152]
5047448
(5047448, 2180)
5047448
5047448
5047448
5047448
------------------------end predict process----------------------------
Env is:prod env
Change log level into DEBUG...
2024-11-11 18:00:13,937 [main] INFO  c.m.data.properties.ClientProperties [ClientProperties.java : 23] - load properties from [client.properties].
2024-11-11 18:00:14,052 [Thread-1] DEBUG com.meitu.data.http.HttpUtil [HttpUtil.java : 115] - Request is POST http://datawork.sdk.server.data.m.com/param HTTP/1.1 ,header is null
2024-11-11 18:00:14,053 [Thread-1] INFO  com.meitu.data.http.HttpUtil [HttpUtil.java : 154] - init httpClient.
2024-11-11 18:00:14,212 [main] INFO  c.m.s.a.c.constant.CommonProperties [CommonProperties.java : 117] - load properties files, file list is file:/data1/www/zxf3/datawork_clinet_conf/ca_config_user_profile_mid.properties
2024-11-11 18:00:14,218 [main] INFO  c.m.s.a.c.constant.CommonProperties [CommonProperties.java : 117] - load properties files, file list is classpath:/META-INF/auth-product.properties
2024-11-11 18:00:14,219 [main] INFO  c.m.s.a.c.constant.CommonProperties [CommonProperties.java : 117] - load properties files, file list is file:/data1/www/zxf3/datawork_clinet_conf/ca_config_user_profile_mid.properties
2024-11-11 18:00:14,220 [main] INFO  c.m.s.a.c.constant.CommonProperties [CommonProperties.java : 105] - 
-------default configuration -------
appId                          = 79fe5be1771a5ef802086454e650c6b9
appKey                         = MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQChRu2q6HswkrExkEFupwWpYKm3kgJ/2iD+J41PUgobc3UKA22aT1L5CgB+RjSlSER4zftiQw4YQj3iz66FDs10u+Molww/LBTU3I8al3wGrpZ8LKGNaniln3WEAUe+aaGq/+Jc2vme5H2cC1UywGkPWp8eSvVPuU7uwvhUH0BxpwIDAQAB
authBaseUrl                    = http://ca.data.m.com/auth-service
consumerGetTokenUrl            = /oauth/access_token
devEnvironment                 = product
providerValidateTokenUrl       = /provider/validate
salt                           = er@vSJ?iLW
--------end  configuration --------
Use discovery service
2024-11-11 18:00:14,241 [main] INFO  c.m.d.d.service.RedisPoolService [RedisPoolService.java : 81] - Init properties is {redis.max.total=10, redis.config=1:m8695.hw.redis.m.com:8695:W8hmDb*@X&yfuGBC, redis.db=1, redis.min.idle=3, redis.max.idle=7}, env is HUAWEI_PROD
HIVE QL: load data local inpath /data1/www/zxf3/agestage_predict/wink/data/predict_result_data_final-20241103.txt  overwrite into table user_profile_mid.uprofile_odz_agestage_model_predict_probability partition(date_p=20241103,type_p="wink_v1")
2024-11-11 18:00:14,298 [main] DEBUG c.m.s.a.c.c.c.ConsumerTokenClient [ConsumerTokenClient.java : 84] - params:[appId=79fe5be1771a5ef802086454e650c6b9, timestamp=1731319214244, sign=2762bee7b63434adea8c2d966a761d44cb9aef9c42a66522bd33c3e3e6ab058d2d9c76dc6a6f5d4ccc790d42a90e8058b587490006be9734fef41c515a1a744e] ,CA response :{"code":0,"ttl":0,"accessToken":"410af27f59011aa197329d990f35e4ef","expiresIn":7200,"lastModifiedTime":0}
2024-11-11 18:00:14,361 [main] INFO  c.m.s.a.c.c.c.CacheConsumerTokenClient [CacheConsumerTokenClient.java : 87] - Start get first token {"accessToken":"410af27f59011aa197329d990f35e4ef","code":0,"expiresIn":7200,"lastModifiedTime":0}
2024-11-11 18:00:14,377 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 971] - DataworkClient HttpPut.url = /datawork-client/userprofile/hive_load, file name:5c6e0cd0_predict_result_data_final-20241103.txt,file length:303087615
2024-11-11 18:00:14,377 [main] INFO  c.m.d.d.c.CachedServiceDiscovery [CachedServiceDiscovery.java : 45] - cache service info list :null
2024-11-11 18:00:14,409 [main] INFO  c.m.d.d.c.CachedServiceDiscovery [CachedServiceDiscovery.java : 51] - can't find from cache.redis discovery service size is 3
2024-11-11 18:00:14,410 [main] INFO  c.m.d.d.c.CachedServiceDiscovery [CachedServiceDiscovery.java : 130] - service list change,now list size is 3,cache list size is 0,to refresh cache data.
2024-11-11 18:00:14,410 [main] DEBUG c.m.d.d.c.f.CheckSumServiceInfoFilter [CheckSumServiceInfoFilter.java : 31] - before checkSum filter data is [ServiceInfo{host='10.16.16.129', port=8871, projectName='data-infr', serviceName='httpfs', version='1'}, ServiceInfo{host='10.16.16.129', port=8871, projectName='data-infr', serviceName='httpfs', version='1'}, ServiceInfo{host='10.16.16.94', port=8871, projectName='data-infr', serviceName='httpfs', version='1'}]
2024-11-11 18:00:14,411 [main] DEBUG c.m.d.d.c.f.CheckSumServiceInfoFilter [CheckSumServiceInfoFilter.java : 54] - after checkSum filter data is [ServiceInfo{host='10.16.16.129', port=8871, projectName='data-infr', serviceName='httpfs', version='1'}, ServiceInfo{host='10.16.16.129', port=8871, projectName='data-infr', serviceName='httpfs', version='1'}, ServiceInfo{host='10.16.16.94', port=8871, projectName='data-infr', serviceName='httpfs', version='1'}]
2024-11-11 18:00:14,412 [main] DEBUG com.meitu.data.http.HttpUtil [HttpUtil.java : 115] - Request is PUT http://10.16.16.94:8871/datawork-client/userprofile/hive_load?op=put&mode=1&fileName=5c6e0cd0_predict_result_data_final-20241103.txt HTTP/1.1 ,header is {accessToken=410af27f59011aa197329d990f35e4ef}
2024-11-11 18:00:28,807 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 974] - DataworkClient result:{"meta":{"code":0,"msg":"成功"},"response":null}
2024-11-11 18:00:28,812 [main] DEBUG c.m.d.c.transform.HiveQLTransform [HiveQLTransform.java : 50] - load data local..tranform hql:load data  inpath '/datawork-client/userprofile/hive_load/5c6e0cd0_predict_result_data_final-20241103.txt' overwrite into table user_profile_mid.uprofile_odz_agestage_model_predict_probability partition(date_p=20241103,type_p="wink_v1")
2024-11-11 18:00:28,812 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 961] - DataworkClient HttpPost param:{sqlEngineType=1, originate=0, needValidateSql=true, notifyTypes=1, clientSourceType=shell, projectName=userprofile, env=huawei, scheduleTaskInstanceId=132584806, sql=load data  inpath '/datawork-client/userprofile/hive_load/5c6e0cd0_predict_result_data_final-20241103.txt' overwrite into table user_profile_mid.uprofile_odz_agestage_model_predict_probability partition(date_p=20241103,type_p="wink_v1")}
2024-11-11 18:00:28,813 [main] DEBUG com.meitu.data.http.HttpUtil [HttpUtil.java : 115] - Request is POST http://api.dataworks.data.m.com//dataworks/sdk/temp/workflow/save/run HTTP/1.1 ,header is {accessToken=410af27f59011aa197329d990f35e4ef}
2024-11-11 18:00:28,973 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 964] - DataworkClient result:{"meta":{"code":0,"msg":"成功","traceId":"03d9688f8117473b9eb35c4e10587536"},"response":{"workflowId":24900535,"taskId":25208729}}
workflow id is 24900535
2024-11-11 18:00:28,974 [Thread-5] DEBUG com.meitu.data.Invoke.Invoke [Invoke.java : 64] - report workflow param to datawork
2024-11-11 18:00:28,974 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 988] - DataworkClient HttpGet url:http://api.dataworks.data.m.com//dataworks/sdk/temp/workflow/progress/24900535
2024-11-11 18:00:28,975 [main] DEBUG com.meitu.data.http.HttpUtil [HttpUtil.java : 115] - Request is GET http://api.dataworks.data.m.com//dataworks/sdk/temp/workflow/progress/24900535 HTTP/1.1 ,header is {accessToken=410af27f59011aa197329d990f35e4ef}
2024-11-11 18:00:28,981 [Thread-5] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 996] - DataworkClient HttpPost url:/dataworks/sdk/common/runtime/situation/report body:{"situation":"{\"args\":\"sh /data1/www/zxf3/agestage_predict/wink/bin/wink_agestage_predict_model.sh 20241103  execute -hql load data local inpath /data1/www/zxf3/agestage_predict/wink/data/predict_result_data_final-20241103.txt  overwrite into table user_profile_mid.uprofile_odz_agestage_model_predict_probability partition(date_p=20241103,type_p=\\\"wink_v1\\\") -project_name userprofile -ca_config_path /data1/www/zxf3/datawork_clinet_conf/ca_config_user_profile_mid.properties -env prd -hive_env huawei -v\",\"clientVersion\":\"2.13.10\",\"ip\":\"10.16.16.146\",\"runtimeCommand\":\"sh /data1/www/zxf3/agestage_predict/wink/bin/wink_agestage_predict_model.sh 20241103 \"}","situationParam":{"args":"sh /data1/www/zxf3/agestage_predict/wink/bin/wink_agestage_predict_model.sh 20241103  execute -hql load data local inpath /data1/www/zxf3/agestage_predict/wink/data/predict_result_data_final-20241103.txt  overwrite into table user_profile_mid.uprofile_odz_agestage_model_predict_probability partition(date_p=20241103,type_p=\"wink_v1\") -project_name userprofile -ca_config_path /data1/www/zxf3/datawork_clinet_conf/ca_config_user_profile_mid.properties -env prd -hive_env huawei -v","clientVersion":"2.13.10","ip":"10.16.16.146","runtimeCommand":"sh /data1/www/zxf3/agestage_predict/wink/bin/wink_agestage_predict_model.sh 20241103 "},"workflowId":24900535}
2024-11-11 18:00:28,982 [Thread-5] DEBUG com.meitu.data.http.HttpUtil [HttpUtil.java : 115] - Request is POST http://api.dataworks.data.m.com//dataworks/sdk/common/runtime/situation/report HTTP/1.1 ,header is {accessToken=410af27f59011aa197329d990f35e4ef}
2024-11-11 18:00:29,007 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 990] - DataworkClient result:{"meta":{"code":0,"msg":"成功","traceId":"5b7fa0f89ffe4c92ba726bd456ed039a"},"response":{"execEndTime":1514736000000,"progress":0.0,"execStartTime":1731319229000,"status":1}}
24900535 appName:Puck_24900535_1_1_ status: running progress: 0.0
2024-11-11 18:00:29,009 [Thread-5] DEBUG com.meitu.data.Invoke.Invoke [Invoke.java : 67] - report workflow param success
2024-11-11 18:00:34,009 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 988] - DataworkClient HttpGet url:http://api.dataworks.data.m.com//dataworks/sdk/temp/workflow/progress/24900535
2024-11-11 18:00:34,009 [main] DEBUG com.meitu.data.http.HttpUtil [HttpUtil.java : 115] - Request is GET http://api.dataworks.data.m.com//dataworks/sdk/temp/workflow/progress/24900535 HTTP/1.1 ,header is {accessToken=410af27f59011aa197329d990f35e4ef}
2024-11-11 18:00:34,043 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 990] - DataworkClient result:{"meta":{"code":0,"msg":"成功","traceId":"4f94c5c65c3a4cdb95a135f23abd367b"},"response":{"execEndTime":1731319232000,"progress":100.0,"execStartTime":1731319229000,"status":3}}
2024-11-11 18:00:34,044 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 988] - DataworkClient HttpGet url:http://api.dataworks.data.m.com//backend/no/authority/app/Puck_24900535_1_1_
2024-11-11 18:00:34,044 [main] DEBUG com.meitu.data.http.HttpUtil [HttpUtil.java : 115] - Request is GET http://api.dataworks.data.m.com//backend/no/authority/app/Puck_24900535_1_1_ HTTP/1.1 ,header is {accessToken=410af27f59011aa197329d990f35e4ef}
2024-11-11 18:00:34,081 [main] DEBUG com.meitu.data.client.DataWorkClient [DataWorkClient.java : 990] - DataworkClient result:{"meta":{"code":0,"msg":"成功","traceId":"2d18556c88d942b292c245db74ef77c8"},"response":{"reason":"","log":{"meta":{"code":0,"traceId":"2d18556c88d942b292c245db74ef77c8"},"response":{"log":"[2024-11-11 18:00:28] 开始执行子任务：SDK_TEMP_QUERY_shell_1305593003741544448\n[2024-11-11 18:00:29] 执行环境：【华为云】\n[2024-11-11 18:00:29] workflowId:24900535, batchId:1, target hdfs path:/tmp/data_works_server/24900535/1/, final SQL:set hive.jobname.length=10;set hive.insert.into.multilevel.dirs=true;set mapreduce.job.running.map.limit=500;set hive.server2.long.polling.timeout=1000ms;set mapreduce.job.queuename=root.up.temp;set mapreduce.job.name=Puck_24900535_1_1_;set spark.yarn.queue=root.up.temp;set spark.app.name=Puck_24900535_1_1_;set spark.data.works.user.name=zxf3;set spark.data.works.project.id=15;set spark.data.works.workflow.id=24900535;set spark.data.works.task.id=25208729;set spark.data.works.task.recordType=0;set spark.data.works.taskRetryTimes=0;set spark.data.works.taskRetryNumber=0;set spark.data.works.isTaskRetryLastTimes=false;set spark.hunter.task.isTryable=false;set spark.data.works.workflow.sdk=1;load data  inpath '/datawork-client/userprofile/hive_load/5c6e0cd0_predict_result_data_final-20241103.txt' overwrite into table user_profile_mid.uprofile_odz_agestage_model_predict_probability partition(date_p=20241103,type_p=\"wink_v1\")\n[2024-11-11 18:00:29] 初始化client成功\n[2024-11-11 18:00:29] 任务配置引擎：hive on spark\n[2024-11-11 18:00:29] 执行 SQL:\nset hive.jobname.length=10\nset hive.insert.into.multilevel.dirs=true\nset mapreduce.job.running.map.limit=500\nset hive.server2.long.polling.timeout=1000ms\nset mapreduce.job.queuename=root.up.temp\nset mapreduce.job.name=Puck_24900535_1_1_\nset spark.yarn.queue=root.up.temp\nset spark.app.name=Puck_24900535_1_1_\nset spark.data.works.user.name=zxf3\nset spark.data.works.project.id=15\nset spark.data.works.workflow.id=24900535\nset spark.data.works.task.id=25208729\nset spark.data.works.task.recordType=0\nset spark.data.works.taskRetryTimes=0\nset spark.data.works.taskRetryNumber=0\nset spark.data.works.isTaskRetryLastTimes=false\nset spark.hunter.task.isTryable=false\nset spark.data.works.workflow.sdk=1\nload data  inpath '/datawork-client/userprofile/hive_load/5c6e0cd0_predict_result_data_final-20241103.txt' overwrite into table user_profile_mid.uprofile_odz_agestage_model_predict_probability partition(date_p=20241103,type_p=\"wink_v1\")\n[2024-11-11 18:00:29] 实际执行引擎：hive on spark\n[2024-11-11 18:00:29] serverUrl: jdbc:hive2://10.16.17.120:2181,10.16.17.30:2181,10.16.17.78:2181/;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2_spark\n[2024-11-11 18:00:29] finalConfiguration: set hive.exec.reducers.bytes.per.reducer=64000000;set spark.hunter.sql.profile.md5=849b90442f880ea88111891092f90e8b;set spark.data.works.task.id=25208729;set spark.hunter.task.isTryable=false;set spark.sql.broadcastTimeout=1200;set mapreduce.job.name=Puck_24900535_1_1_;set hive.insert.into.multilevel.dirs=true;set spark.yarn.executor.memoryOverhead=1024;set spark.yarn.queue=root.up.temp;set spark.app.name=Puck_24900535_1_1_;set spark.data.works.taskRetryTimes=0;set mapreduce.job.queuename=root.up.temp;set spark.data.works.project.id=15;set spark.hunter.sqlMd5=3ea271bf33e24746ac71576d0c46093e;set spark.hunter.report.url=http://hw.hunter.data.meitustat.com/sql/report;set spark.data.works.workflow.sdk=1;set hive.jobname.length=10;set spark.data.works.user.name=zxf3;set mapreduce.job.running.map.limit=500;set spark.data.works.workflow.id=24900535;set spark.data.works.taskRetryNumber=0;set spark.data.works.isTaskRetryLastTimes=false;set spark.data.works.task.recordType=0;set spark.hive.presto.explain.check.enable=false;set hive.server2.long.polling.timeout=1000ms;set spark.hunter.oneSqlRecordId=47517552;set spark.hunter.sql.engine=Hive\n[2024-11-11 18:00:32] 执行SQL完成\n[2024-11-11 18:00:32] 查询的结果为空\n[2024-11-11 18:00:32] 执行任务成功\n"}},"appName":"Puck_24900535_1_1_","creatorId":"赵雪芳","workflowName":"SDK_TEMP_QUERY_shell_1305593003741544448","belongWorkflowName":"wink年龄模型预测","sdk":1,"projectIdNumber":15,"belongScheduleTime":1730690100000,"workflowId":24900535,"taskId":25208729,"belongTaskName":"模型预测","status":"完成"}}
24900535 appName:Puck_24900535_1_1_ status: success progress: 100.0
24900535 success
2024-11-11 18:00:34,083 [main] DEBUG com.meitu.data.ShellClientMain [ShellClientMain.java : 78] - exitCode:0
20241102
